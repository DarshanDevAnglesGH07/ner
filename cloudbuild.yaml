steps:
  - name: python:3.12.1
    entrypoint: pip
    args: ['install', '-r', 'requirements.txt']

  - name: python:3.12.1
    entrypoint: pytest
    args: []

  - name: gcr.io/cloud-builders/gcloud
    args: ['builds', 'submit', '--tag', 'us-central1-docker.pkg.dev/dspl-ai-ml-coe-pocs/ner-with-rl/reinforcement-learning:latest', '.']

  - name: gcr.io/cloud-builders/gcloud
    entrypoint: bash
    args:
      - '-c'
      - |
        gcloud auth configure-docker us-central1-docker.pkg.dev
        gcloud iam service-accounts keys create deployment-key.json \
          --iam-account="for-ner@dspl-ai-ml-coe-pocs.iam.gserviceaccount.com"
        gcloud run deploy your-service-name \
          --image us-central1-docker.pkg.dev/dspl-ai-ml-coe-pocs/ner-with-rl/reinforcement-learning:latest \
          --platform managed \
          --service-account="for-ner@dspl-ai-ml-coe-pocs.iam.gserviceaccount.com" \
          --set-iam-policy="serviceAccount:for-ner@dspl-ai-ml-coe-pocs.iam.gserviceaccount.com:roles/run.invoker" \
          --no-allow-unauthenticated


